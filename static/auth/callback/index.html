<!DOCTYPE html><script type="module">(async()=>{const o=new URLSearchParams(window.location.search),r=o.get("code"),s=o.get("state");if(!r||!s)return;const n=sessionStorage.getItem("oauth_state");if(!n||n!==s)return;sessionStorage.removeItem("oauth_state");const a=sessionStorage.getItem("pkce_verifier");if(!a)return;const c=`${window.location.origin}/auth/callback`,t=await fetch("/api/auth/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:r,codeVerifier:a,redirectUri:c})});if(!t.ok){console.log(await t.json());return}const e=await t.json();console.log(e),localStorage.setItem("customer_access_token",e.access_token),e.refresh_token&&localStorage.setItem("customer_refresh_token",e.refresh_token),sessionStorage.removeItem("pkce_verifier");const i=sessionStorage.getItem("oauth_return_to")||"/";sessionStorage.removeItem("oauth_return_to"),window.location.replace(i)})();</script>